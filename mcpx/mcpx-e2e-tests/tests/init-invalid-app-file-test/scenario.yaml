# Start with ONLY an invalid app.yaml (no mcp.json).
# On first load, the UI should show the "Configuration Error" banner with the
# message "Failed to load MCPX config: data is missing or invalid."
name: "Init with invalid app.yaml"
image: us-central1-docker.pkg.dev/prj-common-442813/mcpx/mcpx:v0.2.12-19b82e8
env: {}
dependentContainers: []
configMount: config
cleanConfigMount: false
verboseOutput: false
disableTest: false
expectErrorsOnStartup: true   # default is false; only set true for “bad config” runs

steps:
  - name: Load Control-Plane UI
    kind: browser
    toolName: browser_navigate
    payload:
      url: http://localhost:5173
    expected:
      mode: regex
      value: "Ran Playwright code"

  - name: Verify Configuration Error banner
    kind: browser
    toolName: browser_evaluate
    payload:
      function: |
        () => {
          const hay = (document.body.innerText || '').toLowerCase();
          const hasTitle = hay.includes('configuration error');
          const hasMsg   = hay.includes('failed to load mcpx config: data is missing or invalid');
          return (hasTitle && hasMsg) ? 'ok-invalid-app-error'
            : JSON.stringify({ hasTitle, hasMsg, sample: hay.slice(0,160) });
        }
    expected:
      mode: contains
      value: ok-invalid-app-error